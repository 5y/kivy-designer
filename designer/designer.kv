#:kivy 1.4.1
#:set bgcolor (.06, .07, .08)
#:set bordercolor (.54, .59, .60)
#:set titlecolor (.34, .39, .40)

<KVLangArea>:
    auto_indent: True
    canvas.after:
        Color:
            rgba: .9, .1, .1, (1 if self.have_error else 0)
        Line:
            points: [self.x, self.y, self.right, self.y, self.right, self.top, self.x, self.top]
            close: True
            width: 2

<SelectClass>:
    select_button: select
    cancel_button: cancel
    orientation: 'vertical'
    padding: '2sp'
    
    GridLayout:
        rows: 1
        size_hint_y: None
        height: '25pt'
        padding: '4sp'
        Button:
            id: select
            text: 'Select Class'
            size_hint_x: None
            width: '90pt'
        Button:
            id: cancel
            text: 'Cancel'
            size_hint_x: None
            width: '90pt'

<RecentDialog>:
    select_button: select
    cancel_button: cancel
    orientation: 'vertical'
    padding: '2sp'
    
    GridLayout:
        rows: 1
        size_hint_y: None
        height: '25pt'
        padding: '4sp'
        Button:
            id: select
            text: 'Open'
            size_hint_x: None
            width: '90pt'
        Button:
            id: cancel
            text: 'Cancel'
            size_hint_x: None
            width: '90pt'

<ConfirmationDialog>:
    orientation: 'vertical'
    padding: '5sp'
    Label:
        text: root.message
    
    BoxLayout:
        size_hint_y: None
        height: '25pt'
        Button:
            text: 'Yes'
            on_press: root.dispatch('on_ok')
        Button:
            text: 'No'
            on_press: root.dispatch('on_cancel')
    
<ActionCheckButton>:
    orientation: 'horizontal'
    background_normal: 'atlas://data/images/defaulttheme/action_bar'
    canvas.before:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size
            source: self.background_normal

<EditContView>:
    ActionPrevious:
        title: "Edit"
        width: 100
        with_previous: True
    ActionOverflow:
    ActionButton:
        text: 'Undo'
        on_press: root.dispatch('on_undo')
    ActionButton:
        text: 'Redo'
        on_press: root.dispatch('on_redo')
    ActionButton:
        text: 'Cut'
        on_press: root.dispatch('on_cut')
    ActionButton:
        text: 'Copy'
        on_press: root.dispatch('on_copy')
    ActionButton:
        text: 'Paste'
        on_press: root.dispatch('on_paste')
    ActionButton:
        text: 'Select All'
        on_press: root.dispatch('on_selectall')
    ActionButton:
        text: 'Delete'
        on_press: root.dispatch('on_delete')
    ActionButton:
        text: 'Add Custom Widget'
        on_press: root.dispatch('on_add_custom')

<Playground>:
    sandbox: sandbox
    do_scale: False
    do_rotation: False
    size_hint: None, None
    size: 600, 400
    pos: 300, 230
    auto_bring_to_front: False
    canvas:
        Color:
            rgb: 1, 1, 1
        Line:
            points: [0, 0, self.width, 0, self.width, self.height, 0, self.height]
            width: 2.
            close: True
    Sandbox:
        id: sandbox
        size: root.size
        pos: root.pos

<PlaygroundDragElement>:
    size_hint: None, None
    size: 100, 100
    canvas:
        Color:
            rgb: (0.9, 0.9, 0.9) if self.can_place else (0.9, 0.1, 0.1)
        Line:
            points: [self.x, self.y, self.center_x - 20, self.y, self.center_x, self.y - 20, self.center_x + 20, self.y, self.right, self.y, self.right, self.top, self.x, self.top]
            close: True
            width: 2.

    on_target: app.focus_widget(args[1])

<Toolbox>:
    accordion: accordion
    Accordion:
        id: accordion
        orientation: 'vertical'
        pos: root.pos
        size_hint_y: None
        height: root.height

<ToolboxCategory>:
    gridlayout: gridlayout
    size_hint_y: None
    height: '22pt'
    title: self.title[0].upper() + self.title[1:]
    ScrollView:
        pos: root.pos
        GridLayout:
            id: gridlayout
            cols: 1
            orientation: 'vertical'
            padding: '5sp'
            spacing: '3sp'
            size_hint_y: None
            size: root.size
    
<ToolboxButton>:
    size_hint_y: None
    height: '22pt'
    font_size: '10pt'
    on_press_and_touch: app.create_draggable_element(self.text, args[1])

<StatusBar>:
    app: app
    navbar: navbar
    gridlayout: gridlayout
    canvas:
        Color:
            rgb: bordercolor
        Rectangle:
            pos: self.x, self.top - 0.5
            size: self.width, 1
        Color:
            rgb: bgcolor
        Rectangle:
            pos: self.pos
            size: self.size

    GridLayout:
        id: gridlayout
        rows: 1
        GridLayout:
            rows: 1
            id: navbar
        BoxLayout:
            size_hint_x: None
            width: '44pt'
            Button:
                text: 'Delete'
                font_size: '10pt'

<StatusNavBarButton>:
    text: getattr(root.node, '__class__').__name__
    font_size: '10pt'
    width: self.texture_size[0] + 20
    size_hint_x: None
    on_release: app.focus_widget(root.node)

<StatusNavBarSeparator>:
    text: '>'
    font_size: '10pt'
    width: self.texture_size[0] + 20
    size_hint_x: None

<PropertyViewer>:
    do_scroll_x: False
    prop_list: prop_list

    canvas:
        Color:
            rgb: bgcolor
        Rectangle:
            pos: self.pos
            size: self.size

    GridLayout:
        id: prop_list
        cols: 2
        padding: 3
        size_hint_y: None
        height: self.minimum_height
        row_default_height: '25pt'

<PropertyLabel>:
    font_size: '10pt'
    valign: 'middle'
    size_hint_x: None
    width: max(100, self.texture_size[0] + 10)

<PropertyBase>:
    propvalue: getattr(self.propwidget, self.propname)
    padding: '6pt', '6pt'

    canvas.after:
        Color:
            rgba: .9, .1, .1, (1 if self.have_error else 0)
        Line:
            points: [self.x, self.y, self.right, self.y, self.right, self.top, self.x, self.top]
            close: True
            width: 2

<PropertyTextInput>:
    border: 8, 8, 8, 8
    text: str(getattr(self.propwidget, self.propname))
    on_text: self.set_value(args[1])

<PropertyBoolean>:
    on_active: self.set_value(args[1])
    active: bool(getattr(self.propwidget, self.propname))

<WidgetsTree>:
    do_scroll_x: False
    tree: tree
    canvas:
        Color:
            rgb: bgcolor
        Rectangle:
            pos: root.pos
            size: root.size

    TreeView:
        id: tree
        height: 1000
        size_hint_y: None
        hide_root: True
        on_selected_node: app.focus_widget(args[1].node)

<WidgetTreeElement>:
    is_open: True
    text: getattr(root.node, '__class__').__name__
    font_size: '10pt'

<Designer>:
    propertyviewer: propertyviewer
    playground: playground
    widgettree: widgettree
    statusbar: statusbar
    kv_code_input: code_input
    actionbar: actionbar
    toolbox: toolbox
    splitter_toolbox: splitter_toolbox
    splitter_kv_code_input: splitter_kv
    grid_widget_tree: grid_widget_tree
    splitter_property: splitter_property
    splitter_widget_tree: splitter_widget_tree

    ActionBar:
        id: actionbar
        pos_hint: {'top': 1}
        size_hint: 1, None
        height: '55sp'
        ActionView:
            ActionPrevious:
                title: 'Kivy Designer'
                width: 200
                with_previous: False
            ActionOverflow:
            ActionGroup:
                text: 'File'
                mode: 'spinner'
                size_hint_x: None
                width: 90
                ActionButton:
                    text: 'New'
                    on_press: root.action_btn_new_pressed()
                ActionButton:
                    text: 'Open'
                    on_press: root.action_btn_open_pressed()
                ActionButton:
                    text: 'Save'
                    on_press: root.action_btn_save_pressed()
                ActionButton:
                    text: 'Save As'
                    on_press: root.action_btn_save_as_pressed()
                ActionButton:
                    text: 'Recent Files'
                    on_press: root.action_btn_recent_files_pressed()
                ActionButton:
                    text: 'Quit'
                    on_press: root.action_btn_quit_pressed()

            ActionGroup:
                text: 'View'
                mode: 'spinner'
                size_hint_x: None
                width: 90
                ActionCheckButton:
                    text: 'Toolbox'
                    minimum_width: 150
                    on_active: root.action_chk_btn_toolbox_active(self)
                ActionCheckButton:
                    text: 'Property Viewer'
                    minimum_width: 150
                    on_active: root.action_chk_btn_property_viewer_active(self)
                ActionCheckButton:
                    text: 'Widget Tree'
                    minimum_width: 150
                    on_active: root.action_chk_btn_widget_tree_active(self)
                ActionCheckButton:
                    text: 'StatusBar'
                    minimum_width: 150
                    on_active: root.action_chk_btn_status_bar_active(self)
                ActionCheckButton:
                    text: 'KV Area'
                    minimum_width: 150
                    on_active: root.action_chk_btn_kv_area_active(self)

    GridLayout:
        size_hint: 1, None
        height: root.height - actionbar.height - statusbar.height
        y: statusbar.height
        cols: 1
        splitter_toolbox: splitter_toolbox
        splitter_widget_tree: splitter_widget_tree

        FloatLayout:
            size_hint: 1,1
            canvas:
                Color:
                    rgb: .21, .22, .22
                Rectangle:
                    pos: self.pos
                    size: self.size

            Playground:
                id: playground
                canvas.before:
                    Color:
                        rgb: 0, 0, 0
                    Rectangle:
                        size: self.size
                on_show_edit: root.on_show_edit()

            Splitter:
                id: splitter_kv
                sizable_from: 'top'
                size_hint_y: None
                size_hint_x: None
                height: 200
                max_size: 500
                x: splitter_toolbox.width
                width: root.width - self.x - splitter_widget_tree.width
                y: statusbar.height
                    
                ScrollView:
                    KVLangArea:
                        id: code_input
                        size_hint_y: None
                        height: 1000                        
                        on_show_edit: root.on_show_edit()

            Splitter:
                id: splitter_toolbox
                sizable_from: 'right'
                min_size: 150
                size_hint: None, 1
                width: 150
                pos_hint: {'y': 0, 'x': 0}
                GridLayout:
                    cols: 1
                    canvas:
                        Color:
                            rgb: bgcolor
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    Label:
                        text: 'Toolbox'
                        font_size: '10pt'
                        height: '20pt'
                        size_hint_y: None

                        canvas.before:
                            Color:
                                rgb: titlecolor
                            Rectangle:
                                pos: self.pos
                                size: self.size

                    Toolbox:
                        id: toolbox

            Splitter:
                id: splitter_widget_tree
                size_hint_x: None
                min_size: 170
                width: 250
                pos_hint: {'y': 0, 'right': 1}
                GridLayout:
                    cols: 1
                    spacing: .5

                    canvas:
                        Color:
                            rgb: titlecolor
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    GridLayout:
                        id: grid_widget_tree
                        cols: 1
                        spacing: .5
                        Label:
                            text: 'Widget Navigator'
                            font_size: '10pt'
                            height: '20pt'
                            size_hint_y: None

                        WidgetsTree:
                            id: widgettree
                            playground: playground

                    Splitter:
                        id: splitter_property
                        sizable_from: 'top'
                        size_hint_y: None
                        height: 300
                        max_size: 500
                        BoxLayout:
                            orientation: 'vertical'
                            Label:
                                text: 'Property Navigator'
                                font_size: '10pt'
                                height: '20pt'
                                size_hint_y: None

                            PropertyViewer:
                                id: propertyviewer

    StatusBar:
        id: statusbar
        size_hint_y: None
        height: '20pt'
        pos_hint: {'y': 0}
